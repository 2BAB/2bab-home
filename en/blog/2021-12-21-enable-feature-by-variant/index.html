<html lang="en" dir="ltr">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="Build Guide #12 Enabling Plugin Features Based on Variant" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://2bab.me/en/blog/2021-12-21-enable-feature-by-variant/" />
  <link rel="stylesheet" href="/styles/main.css">
  <link rel="me" href="https://2bab.me/">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.27.0/themes/prism.min.css">
  
  <title>Build Guide #12 Enabling Plugin Features Based on Variant | 2BAB&#39;s Blog</title>
  
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NFRNXW3SHS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NFRNXW3SHS');
</script>

<body>
  
<div>
  <div class="container mx-auto prose py-12 sm:py-24 px-12 sm:px-0">
    <div class="mb-12">
      <a class="no-underline font-bold" href="/">2BAB&#39;s Blog</a>
    </div>
    <h1>Build Guide #12 Enabling Plugin Features Based on Variant</h1>
    <div class="italic text-gray-500">
      2021/12/21
    </div>
    <div>
      <p>Anyone who has used third-party Gradle plugins in Android development should have encountered this problem: <strong>I only want to apply this plugin in certain buildTypes or flavors, but I can't find a suitable way.</strong></p>
<p>The root cause of this problem is that Variant (buildType + flavor) is not a Gradle concept, but comes from Android Gradle Plugin (AGP)'s multi-channel configuration. So from Gradle's platform perspective, it's difficult to provide convenient support upward: plugin introduction within a project is global and platform-level, not changed by the will of any particular plugin (AGP).</p>
<p>OK, but our problem still needs to be solved, hence the four solutions below (fog). We'll explain the ideas in order from ineffective to highly effective.</p>
<h2 id="applying-plugins-based-on-variant-(ineffective-x)" tabindex="-1">Applying Plugins Based on Variant (Ineffective X)</h2>
<pre class="language-kotlin"><code class="language-kotlin">flavorDimensions <span class="token operator">+=</span> <span class="token string-literal singleline"><span class="token string">"server"</span></span><br>productFlavors <span class="token punctuation">{</span><br>    <span class="token operator">..</span><span class="token punctuation">.</span><br>    <span class="token function">create</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"production"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        dimension <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"server"</span></span><br>        applicationIdSuffix <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">".production"</span></span><br>        versionNameSuffix <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"-production"</span></span><br>        versionCode <span class="token operator">=</span> <span class="token number">2</span><br>        <span class="token function">apply</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"xxx"</span></span><span class="token punctuation">)</span> <span class="token comment">// Ineffective</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Many Android or Gradle beginners think, can't I just put <code>apply(...)</code> here? (Of course, you can't use <code>plugins { id(&quot;xxx&quot;) }</code>). The misconception here is that <strong>the <code>apply(...)</code> method has no association with the current context object</strong>:</p>
<p><img src="https://2bab-images.lastmayday.com/20211221205845.png?imageslim" alt=""></p>
<p><img src="https://2bab-images.lastmayday.com/20211221210042.png?imageslim" alt=""></p>
<ul>
<li>The closure context of <code>create(&quot;...&quot;){}</code> is <code>this:ApplicationProductFlavor</code>.</li>
<li><code>apply(...)</code> is an extension method mounted on PluginAware (in <code>build.gradle.kts</code>), acting on the entire Project, so your plugin will still be introduced globally.</li>
</ul>
<p>A similar classic misconception:</p>
<pre class="language-kotlin"><code class="language-kotlin"><span class="token function">create</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"production"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    dimension <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"server"</span></span><br>    applicationIdSuffix <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">".production"</span></span><br>    versionNameSuffix <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"-production"</span></span><br>    versionCode <span class="token operator">=</span> <span class="token number">2</span><br>    packagingOptions <span class="token punctuation">{</span><br>        jniLibs <span class="token punctuation">{</span><br>            excludes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"..."</span></span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p><img src="https://2bab-images.lastmayday.com/20211221212514.png?imageslim" alt=""></p>
<p>You might think this sets separate <code>packagingOptions</code> for this flavor, but actually this method is a method of the <code>CommonExtension</code> interface, not belonging to <code>ApplicationProductFlavor</code>. That is, it sets for the entire Android Gradle Plugin, not a single flavor. If you make different settings in each flavor, the last setting will override all previous ones. For solutions to this problem, refer to the &quot;Secondary Configuration&quot; section in my previous <a href="https://www.bilibili.com/video/BV1WP4y1G71h">GDG sharing</a>.</p>
<h2 id="applying-plugins-based-on-command-(partially-effective-x)" tabindex="-1">Applying Plugins Based on Command (Partially Effective X)</h2>
<p>The problem we're discussing can also be found in some StackOverflow Q&amp;As, with many answers about &quot;parsing the entered command&quot; for judgment.</p>
<pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">if</span> <span class="token punctuation">(</span>gradle<span class="token punctuation">.</span>startParameter<span class="token punctuation">.</span>taskRequests<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"production"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">apply</span><span class="token punctuation">(</span><span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre>
<p>This approach can solve situations where your entered command is <code>./gradlew clean assembleProductionRelease</code> etc., because such commands only contain information for one Variant (i.e., Production + Release). However, if the entered command is <code>./gradlew clean assembleRelease</code>, which packages both <code>Staging</code> and <code>Production</code> flavors simultaneously, the <code>if(...)</code> condition above won't hold at all, and your build will be broken.</p>
<p>In most cases, <code>taskRequests</code> should not be obtained and used by third-party Android build plugin developers. Like the first misconception, it's Gradle's platform API, not optimized for AGP's upper-level Variant concept.</p>
<h2 id="disabling-corresponding-variant's-plugin-tasks-(effective-y)" tabindex="-1">Disabling Corresponding Variant's Plugin Tasks (Effective Y)</h2>
<p>Of course, there are also correct, effective, and universal approaches mentioned on SO — <strong>don't dynamically disable (or enable) plugins, disable the Tasks within the plugin instead.</strong></p>
<pre class="language-kotlin"><code class="language-kotlin">plugins <span class="token punctuation">{</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"com.example.ua"</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span><br><span class="token comment">// or apply("com.example.ua")</span><br><span class="token operator">..</span><span class="token punctuation">.</span><br>tasks<span class="token punctuation">.</span><span class="token function">whenTaskAdded</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"production"</span></span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><br>            <span class="token operator">&amp;&amp;</span> name<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"release"</span></span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><br>            <span class="token operator">&amp;&amp;</span> name<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"UploadArchive"</span></span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        enabled <span class="token operator">=</span> <span class="token boolean">false</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Suppose there's an upload build result plugin called <code>com.example.ua</code>. No matter what situation, we reference it in <code>build.gradle.kts</code>. But looking below, we made a similar <code>if(...)</code> judgment as the previous misconception based on <code>whenTaskAdded {...}</code>, then set the matching task's <code>enabled</code> property to <code>false</code>. Why doesn't the previous method work while this one does?</p>
<p>Let's review this Gradle script and <code>android{}</code> DSL rule: no matter what command you enter in shell, whether <code>clean</code> or <code>help</code>, this script will be completely executed, and all Variant Tasks will be registered (though nowadays it's usually lazy registration with <code>register(...)</code> instead of <code>create()</code>). <strong>And <code>whenTaskAdded{...}</code> is a Gradle platform API. It doesn't care whether your upper-level registered Tasks are divided by Variant — it just provides a callback timing for developers for all registered Tasks that will definitely be added to the run graph (which is a DAG). Meanwhile, almost all Android ecosystem cooperative plugins name their Tasks based on Variant name (if it needs to be a VariantAware Task), such as &quot;UploadArchiveWithLogForProductionRelease&quot;. This unwritten rule gives us the opportunity for string matching, which is the code you see above.</strong></p>
<p>As for how to find all corresponding Tasks for a plugin, there's currently no automated way, nor an API (though in a recent AGP Team Q&amp;A, they mentioned they're working with Gradle to advance this feature). What you can do is: <strong>print the Task List before introducing the plugin, print again after introducing it, and find the Diff between them.</strong> Of course, for some simpler plugins, you can just look at the documentation or source code to organize which Tasks there are.</p>
<p>So this solution can be summarized in one sentence: always reference the plugin, but disable unneeded Tasks.</p>
<h2 id="intercepting-at-task-registration-(highly-effective-y)" tabindex="-1">Intercepting at Task Registration (Highly Effective Y)</h2>
<p>I mentioned in the previous article <a href="https://2bab.me/2021/12/19/bundle-tool-plugin">Build Guide #11 BundleTool Gradle Plugin</a>:</p>
<blockquote>
<p>bundle-tool-gradle-plugin supports enabling plugin features by different variant channels.</p>
</blockquote>
<p>Just hearing this sounds similar to the previous solution — could it be hiding <code>enabled = false</code> inside the Plugin, then exposing a DSL switch configuration for users to choose? Actually no, the solution approach is already very similar. But thinking a bit more, there are two areas for improvement:</p>
<ol>
<li>Since we want to control the switch inside the plugin, why use <code>task.enabled = false</code>? <strong>Just skip the registration process directly</strong> (of course, this approach isn't suitable for all situations; sometimes dynamic disabling is still needed).</li>
<li>For most Android ecosystem cooperative plugins, their DSL is generally Variant-unrelated static configuration. If you want to design a Variant-related configuration, you might only be able to pass in a bunch of custom rules (as in the code below):</li>
</ol>
<pre class="language-kotlin"><code class="language-kotlin"><span class="token comment">// Static DSL configuration</span><br>bundletool <span class="token punctuation">{</span><br>    enableByVariantRules <span class="token punctuation">{</span><br>        <span class="token function">create</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"debugStaging"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            enabledFeature1 <span class="token operator">=</span> <span class="token boolean">true</span><br>            enabledFeature2 <span class="token operator">=</span> <span class="token boolean">true</span><br>            enabledFeature3 <span class="token operator">=</span> <span class="token boolean">false</span><br>        <span class="token punctuation">}</span><br>        <span class="token function">create</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"debugProduction"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token operator">..</span><span class="token punctuation">.</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>The complexity of such rules is hard to control. In the above code, it's a Cartesian product of 2 * 2 * 3, making configuration very inconvenient. The solution is also easy to think of: <strong>if it could be passed as a Kotlin Lambda (or Groovy Closure), wouldn't that be convenient? Just like the <code>onVariants(...) {...}</code> method we use for secondary configuration, we need something &quot;dynamic,&quot; something users can interact with, to reduce configuration complexity.</strong></p>
<pre class="language-kotlin"><code class="language-kotlin"><span class="token comment">// "Dynamic" DSL configuration, based on Kotlin Lambda and Groovy Closure</span><br>bundleTool <span class="token punctuation">{</span><br>    enableByVariant <span class="token punctuation">{</span> variant<span class="token punctuation">,</span> feature <span class="token operator">-></span><br>        <span class="token operator">!</span><span class="token punctuation">(</span>variant<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"debug"</span></span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> feature <span class="token operator">==</span> BundleToolFeature<span class="token punctuation">.</span>GET_SIZE<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>    <span class="token operator">..</span><span class="token punctuation">.</span><br><span class="token punctuation">}</span></code></pre>
<p>The <code>variant</code> parameter is <code>com.android.build.api.variant.Variant</code>, the Variant object from Variant API v2 we normally use; the <code>feature</code> parameter is a custom enum class, convenient for each plugin to customize. Now let's look at the implementation:</p>
<pre class="language-kotlin"><code class="language-kotlin"><span class="token comment">/**<br> * Extract `enableByVariant(...)` function, can be reused in other plugins.<br> * Currently the Lambda and Closure are defined by raw types, they can be encapsulated<br> * by [Property] as well to fulfill "lazily produced/consumed" purpose.<br> */</span><br><span class="token keyword">abstract</span> <span class="token keyword">class</span> EnableByFeatureExtension<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span><br><br>    <span class="token keyword">var</span> kotlinEnableByVariant<span class="token operator">:</span> EnableByVariant<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span><br><br>    <span class="token keyword">var</span> groovyEnableByVariant<span class="token operator">:</span> Closure<span class="token operator">&lt;</span>Boolean<span class="token operator">></span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span><br><br>    <span class="token comment">// For Gradle Kotlin DSL</span><br>    <span class="token keyword">fun</span> <span class="token function">enableByVariant</span><span class="token punctuation">(</span>selector<span class="token operator">:</span> EnableByVariant<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        kotlinEnableByVariant <span class="token operator">=</span> selector<br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// For Gradle Groovy DSL</span><br>    <span class="token keyword">fun</span> <span class="token function">enableByVariant</span><span class="token punctuation">(</span>selector<span class="token operator">:</span> Closure<span class="token operator">&lt;</span>Boolean<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        groovyEnableByVariant <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">dehydrate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">internal</span> <span class="token keyword">fun</span> <span class="token function">isFeatureEnabled</span><span class="token punctuation">(</span>variant<span class="token operator">:</span> Variant<span class="token punctuation">,</span> t<span class="token operator">:</span> T<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token operator">=</span> <span class="token keyword">when</span> <span class="token punctuation">{</span><br>        kotlinEnableByVariant <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">-></span> <span class="token punctuation">{</span><br>            kotlinEnableByVariant<span class="token operator">!!</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>variant<span class="token punctuation">,</span> t<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        groovyEnableByVariant <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">-></span> <span class="token punctuation">{</span><br>            groovyEnableByVariant<span class="token operator">!!</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>variant<span class="token punctuation">,</span> t<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">else</span> <span class="token operator">-></span> <span class="token boolean">false</span><br>    <span class="token punctuation">}</span><br><br><span class="token punctuation">}</span><br><br><span class="token keyword">internal</span> <span class="token keyword">typealias</span> EnableByVariant<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>variant<span class="token operator">:</span> Variant<span class="token punctuation">,</span> t<span class="token operator">:</span> T<span class="token punctuation">)</span> <span class="token operator">-></span> Boolean<br><br><span class="token keyword">abstract</span> <span class="token keyword">class</span> BundleToolExtension<span class="token operator">:</span> EnableByFeatureExtension<span class="token operator">&lt;</span>BundleToolFeature<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br><br>    <span class="token keyword">abstract</span> <span class="token keyword">val</span> buildApks<span class="token operator">:</span> NamedDomainObjectContainer<span class="token operator">&lt;</span>BuildApksRule<span class="token operator">></span><br><br>    <span class="token keyword">abstract</span> <span class="token keyword">val</span> getSize<span class="token operator">:</span> NamedDomainObjectContainer<span class="token operator">&lt;</span>GetSizeRule<span class="token operator">></span><br><br><span class="token punctuation">}</span><br><br><span class="token keyword">enum</span> <span class="token keyword">class</span> BundleToolFeature <span class="token punctuation">{</span><br><br>    <span class="token comment">// It's currently a predecessor for GET_SIZE,</span><br>    <span class="token comment">// and the first job that plugin does,</span><br>    <span class="token comment">// disable it will cause the task registry got removed.</span><br>    <span class="token comment">// The work action that transforms .aab to .apks using `build-apks` command.</span><br>    BUILD_APKS<span class="token punctuation">,</span><br><br>    <span class="token comment">// The work action that gets the transformed .apks file size using `get-size total` command.</span><br>    GET_SIZE<br><br><span class="token punctuation">}</span></code></pre>
<p>Here we defined Closure/Lambda for both Groovy and Kotlin Gradle DSL. They accept <code>Variant</code> and a custom generic parameter, returning a Boolean value indicating whether to enable the corresponding feature. Then we defined the <code>isFeatureEnabled(..,): Boolean</code> method to integrate both language branches, convenient for internal plugin calls. When actually using this <code>EnableByFeatureExtension</code>, we let the plugin's <code>BundleToolExtension</code> inherit from it, thus isolating the plugin's main functionality from the general switch feature. Any other plugin can conveniently copy this class and add it to their own Extension.</p>
<pre class="language-kotlin"><code class="language-kotlin">androidExtension<span class="token punctuation">.</span><span class="token function">onVariants</span> <span class="token punctuation">{</span> variant <span class="token operator">-></span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>config<span class="token punctuation">.</span><span class="token function">isFeatureEnabled</span><span class="token punctuation">(</span>variant<span class="token punctuation">,</span> BundleToolFeature<span class="token punctuation">.</span>BUILD_APKS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span><span class="token label symbol">@onVariants</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">val</span> featureGetSize <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">isFeatureEnabled</span><span class="token punctuation">(</span>variant<span class="token punctuation">,</span> BundleToolFeature<span class="token punctuation">.</span>GET_SIZE<span class="token punctuation">)</span><br>    <span class="token operator">..</span><span class="token punctuation">.</span><br>    <span class="token keyword">val</span> buildApksTaskProvider <span class="token operator">=</span> project<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span>register<span class="token operator">&lt;</span>BundleToolTask<span class="token operator">></span><span class="token punctuation">(</span><br>        <span class="token string-literal singleline"><span class="token string">"TransformApksFromBundleFor</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">variantName</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><br>    <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        enableGetSizeFeature <span class="token operator">=</span> featureGetSize<br>        <span class="token operator">..</span><span class="token punctuation">.</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">abstract</span> <span class="token keyword">class</span> BundleToolTask <span class="token operator">:</span> <span class="token function">DefaultTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br><br>    <span class="token annotation builtin">@get:Input</span><br>    <span class="token keyword">var</span> enableGetSizeFeature<span class="token operator">:</span> Boolean <span class="token operator">=</span> <span class="token boolean">false</span><br>    <span class="token operator">..</span><span class="token punctuation">.</span><br><br>    <span class="token annotation builtin">@TaskAction</span><br>    <span class="token keyword">fun</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token operator">..</span><span class="token punctuation">.</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>enableGetSizeFeature<span class="token punctuation">)</span> <span class="token keyword">return</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Finally, we demonstrated examples of using this switch in two places:</p>
<ol>
<li>If a Feature affects the entire Task, we can use the switch to skip its registration.</li>
<li>If a Feature only affects part of a Task's functionality, we pass the switch value into the Task for internal judgment.</li>
</ol>
<p>The above process is not entirely fixed; this idea can be adjusted in combination with other switch methods. I've already used this solution in <a href="https://github.com/2BAB/bundle-tool-gradle-plugin">bundle-tool-gradle-plugin</a> and <a href="https://github.com/2BAB/ScratchPaper">ScratchPaper</a>, making plugin feature introduction more flexible.</p>
<p><strong>Of course, you may have also noticed that this solution is from the plugin development perspective. Unless all plugin developers use a similar solution for optimization, Solution 3 remains the only universal approach from the user's perspective. But the advantage of this solution is finer granularity control and more convenience — developers can customize as they wish.</strong></p>
<h2 id="summary" tabindex="-1">Summary</h2>
<p>This article mainly discussed solutions for enabling plugin features based on different Variant channels. It may also be the first time there's been such detailed and complete multi-solution comparative discussion anywhere online. The thinking and solutions in this article can actually be applied to other Gradle scenarios as well — feel free to use your imagination. That's it for the last technical article of 2021. See you next year!</p>

    </div>
    <hr />
      <div class="text-sm text-center">
        For comments and further discussion, mail to xx2bab@gmail.com
      </div>
      <hr />
    
    <footer class="text-sm py-12 text-gray-500 text-center">
  
  <p><a href="/">ENG</a> / <a href="/zh">中文</a></p>
  
  2BAB's Blog since 2014
</footer>
  </div>

</div>



</body>
</html>