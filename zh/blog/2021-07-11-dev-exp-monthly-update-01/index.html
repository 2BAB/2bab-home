<html lang="zh" dir="ltr">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="AB çš„å·¥ç¨‹æ•ˆç‡å°é›† #1 ä¸ƒæœˆåˆŠ" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://2bab.me/zh/blog/2021-07-11-dev-exp-monthly-update-01/" />
  <link rel="stylesheet" href="/styles/main.css">
  <link rel="me" href="https://2bab.me/">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.27.0/themes/prism.min.css">
  
  <title>AB çš„å·¥ç¨‹æ•ˆç‡å°é›† #1 ä¸ƒæœˆåˆŠ | 2BAB&#39;s Blog</title>
  
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NFRNXW3SHS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NFRNXW3SHS');
</script>

<body>
  
<div>
  <div class="container mx-auto prose py-12 sm:py-24 px-12 sm:px-0">
    <div class="mb-12">
      <a class="no-underline font-bold" href="/zh/">2BAB&#39;s Blog</a>
    </div>
    <h1>AB çš„å·¥ç¨‹æ•ˆç‡å°é›† #1 ä¸ƒæœˆåˆŠ</h1>
    <div class="italic text-gray-500">
      2021/07/11
    </div>
    <div>
      <p>çº¦æ˜¯å¹´åˆå¼€å§‹ï¼Œæˆ‘æŒç»­ä¸æ–­åœ°åœ¨ä¸€äº›è¾ƒæœ‰è®¨è®ºæ°›å›´çš„ç¤¾åŒºã€ç¤¾ç¾¤ï¼Œå‚ä¸æˆ‘æ„Ÿå…´è¶£çš„æŠ€æœ¯è¯é¢˜äº’åŠ¨ã€‚ç»è¿‡åŠå¹´çš„ä½“éªŒï¼Œè¿™ç±»æŒç»­è¾“å…¥è¾“å‡ºå¯¹æˆ‘ä¸ªäººæœ‰ä¸å°‘çš„æ”¶è·ã€‚ä¸€æ–¹é¢æˆ‘èƒ½ä»è¿™äº›ç¤¾åŒºç¤¾ç¾¤çœ‹åˆ°ä¸å°‘æ–°ä¸œè¥¿ï¼Œä¾‹å¦‚ç¬¬ä¸€æ—¶é—´çœ‹åˆ°ä¸–ç•Œå„åœ°çš„æŠ€æœ¯è®¿è°ˆã€åšå®¢ã€æ–°é—»ã€æ´»åŠ¨ï¼›å¦å¤–ä¸€æ–¹é¢æˆ‘çš„çŸ¥è¯†ä½“ç³»åœ¨åå“ºç¤¾åŒºå’Œè®¨è®ºçš„è¿‡ç¨‹ä¸­é€æ­¥å®Œå–„ã€‚</p>
<p>å¯æƒœï¼Œä¸å°‘çš„ç¤¾åŒºç¤¾ç¾¤å¹¶ä¸èƒ½è¢«æœç´¢å¼•æ“è®°å½•ï¼Œä¾‹å¦‚ Slackã€æ˜Ÿçƒã€ä»¥åŠå„ç§æ™®é€š IM å·¥å…·å†…çš„ç¾¤ç»„ã€‚åœ¨ç¬¬å…«æœŸ<a href="https://binary.2bab.me/episodes/008-enlightenment-n-self-innovation">â€œäºŒåˆ†ç”µå°â€</a>è®¨è®ºâ€æŒç»­å­¦ä¹ â€œè¯é¢˜æ—¶ï¼ŒRandy å’Œæˆ‘èŠåˆ°äº†<a href="https://www.swyx.io/learn-in-public/">ã€ŠLearn in Publicã€‹</a>è¿™ç¯‡æ–‡ç« â€”â€”æ˜¯çš„ï¼Œ<strong>å›ºç„¶åŠ å…¥äº†æŸä¸ª Slack ç¤¾åŒºåå¯ä»¥åœ¨é‡Œé¢æœç´¢å†å²è®°å½•ï¼Œä½†æ˜¯å®ƒä¾ç„¶ä¸æ˜¯æœç´¢å¼•æ“å¯è§çš„</strong>ã€‚ç‰¹åˆ«åƒ Gradle è¿™ç±»å¤§å®¶â€œç†Ÿæ‚‰çš„é™Œç”Ÿäººâ€ï¼Œæˆ‘ä»¬æ¯å¤©éƒ½åœ¨ç”¨ï¼Œä½†çœŸç¢°åˆ°ä¸€ä¸ªä»€ä¹ˆå¥‡æ€ªçš„é—®é¢˜æƒ³èµ¶ç´§çŸ¥é“ï¼ˆä¸ä¸€å®šæ˜¯ bugï¼Œå¯èƒ½åªæ˜¯ä¸€ä¸ªç”¨æ³•ã€ä¸€ä¸ª API çš„ç†è§£ç­‰ï¼‰ï¼Œç›®å‰æœ€å¥½çš„åŠæ³•è¿˜æ˜¯å»ä»–ä»¬çš„ Slack ç¤¾åŒºäº’åŠ¨ï¼Œçºµç„¶ä»–ä»¬æœ‰è®ºå›å’Œ StackOverflow çš„ tagã€‚<strong>è¿™äº›â€œå°é—­â€çš„å†…å®¹æ— æ³•æœ‰æ•ˆåœ°è¢«æ›´å¹¿æ³›çš„äººç¾¤æ¥å—ï¼Œæ–°æ‰‹å¾ˆéš¾ä»å¤–éƒ¨è·å–åˆ°æœ€æ–°çš„èµ„è®¯ã€è®¨è®ºï¼›ä»¥è‡³äºæˆ‘æœ‰æ—¶å€™ç”šè‡³è§‰å¾—æŠ€æœ¯åˆ†äº«çš„è§†é¢‘å¦‚æœä¸æŠŠ timeline å’Œå…³é”®å­—æ ‡æ³¨å‡ºæ¥ï¼Œä¹Ÿä¼šæµå¤±å¤§é‡æœ¬æ¥å¯ä»¥ç‚¹å‡»è¿›å…¥çš„è§‚ä¼—ã€‚</strong></p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä¸€ç›´æœ‰è¿™ä¸ªæƒ³æ³•ï¼šåšä¸€ä¸ªæœˆåº¦æˆ–è€…åŠæœˆçš„å°é›†åˆï¼ŒæŠŠæˆ‘å‚ä¸è¿‡ã€å…·æœ‰é€šç”¨ä»·å€¼çš„ä¸€äº›ä¸œè¥¿è®°å½•ä¸‹æ¥ã€å…¬å¼€å‡ºå»ã€‚</p>
<ul>
<li>è¿™ç±»é—®ç­”å¼çš„å†…å®¹ï¼Œå¦‚æœå•ç‹¬å†™æˆä¸€ç¯‡ï¼Œå¯èƒ½æœ‰äº› overkill äº†ï¼Œæ‰€ä»¥å®šä½åœ¨ä¸€ä¸ªæœˆåº¦çš„å°é›†çš„å½¢å¼ï¼›</li>
<li>ç›®å‰ä»¥æˆ‘å‚ä¸è¿‡çš„å†…å®¹ä¸ºä¸»ï¼Œåœ¨æ‰€æœ‰çš„å†…å®¹ç¡®ä¿æ˜¯æ— ç‰ˆæƒã€æˆ–è€…æˆ‘æ‹¥æœ‰ç‰ˆæœ¬çš„æƒ…å†µä¸‹ï¼Œå†æ•´ç†ã€è®°å½•ã€æ²‰æ·€ï¼Œåé¢ä¹Ÿä¼šè€ƒè™‘åŠ å…¥ä¸€äº› Slack æˆ–å…¶ä»–ç¾¤ç»„ä¸Šæˆ‘çœ‹åˆ°çš„ç²¾å½©å†…å®¹ï¼›</li>
<li>è‡³äºåˆ†å‘å½¢å¼ï¼Œæˆ‘æ–Ÿé…Œçš„ç»“è®ºæ˜¯ï¼šå…ˆåœ¨æˆ‘çš„åšå®¢è®°å½•ï¼Œå…¬ä¼—å·/æ˜é‡‘ç­‰äºŒæ¬¡åˆ†å‘ï¼Œå¦‚æœæœ‰å…¶ä»–æœ‹å‹å‚ä¸ä¸€èµ·åšä¸”æ–¹å‘æ¯”è¾ƒç»Ÿä¸€åœ¨å·¥ç¨‹æ•ˆç‡å’Œå¼€å‘ä½“éªŒè¿™å—çš„è¯ï¼Œå¯ä»¥å°è¯• Substack è¿™ç§é‚®ä»¶è®¢é˜…çš„å½¢å¼åšè®¢é˜…ã€‚ä½†ç›®æ ‡æ˜¯ä¸å˜çš„ï¼Œéœ€è¦åœ¨å…¬å¼€çš„äº’è”ç½‘é¢†åŸŸç•™ä¸‹è¿™äº›æœ‰å‚è€ƒä»·å€¼çš„å†…å®¹ã€‚</li>
</ul>
<p>OKï¼Œé‚£æˆ‘ä»¬è¿›å…¥ç¬¬ä¸€æœŸçš„æ­£æ–‡ã€‚<strong>2021 å¹´ 7 æœˆå·¥ç¨‹æ•ˆç‡å°é›†ï¼š</strong></p>
<h2 id="%E6%9E%84%E5%BB%BA%EF%BC%9Agradle%2Fagp%2Fci%2F..." tabindex="-1">æ„å»ºï¼šGradle/AGP/CI/...</h2>
<p><strong><a href="https://gradle-community.slack.com/archives/CA7UM03V3/p1624871227328200">Q1</a>: To pass a bunch of File which come from different dirs, should I use <code>SetProperty&lt;File&gt;</code> or <code>SetProperty&lt;RegularFile&gt;</code> ?</strong></p>
<p>A1:</p>
<ul>
<li>@vierbergenlars: I think a FileCollection is better suited for that.
It also gives you some nice additional methods to add files and to manage them.</li>
<li>@wolfs: I agree, ConfigurableFileCollection is the analog to RegularFile/DirectoryProperty for multiple files.</li>
</ul>
<p>è¿™åˆ™é—®ç­”æ¥è‡ªäº Gradle Slack ç¤¾åŒºï¼Œèµ·å› æ˜¯æˆ‘åœ¨å†™ä¸€ä¸ª demo æ—¶å‘ç°æœ‰ä¸€ä¸ªåœºæ™¯æ˜¯éœ€è¦æ”¶é›†ä¸€äº›æ¥è‡ªä¸åŒæ–‡ä»¶å¤¹çš„æ–‡ä»¶ï¼Œå¹¶ä¼ å…¥åˆ°æŸä¸ª Taskã€‚å¯¹äºè¿™ç±»åœºæ™¯ï¼Œä¸ç®¡æ˜¯å¤šä¸ªæ–‡ä»¶ã€æ–‡ä»¶å¤¹ï¼Œæˆ–è€…æ··åˆçš„åœºæ™¯ï¼Œä½¿ç”¨ <code>FileCollection</code> éƒ½æ˜¯æ¯”è¾ƒå¥½çš„é€‰é¡¹ï¼Œå› ä¸ºå®ƒçš„ API åœ¨é¢å¯¹è¿™ç±»åœºæ™¯æ—¶æ¯”è¾ƒå‹å¥½ï¼Œæ¯”å¦‚ <code>from(varags Object)</code>ã€‚å¦‚æœæƒ³ä¿æŒä¸€è‡´æ€§éƒ½ä½¿ç”¨ <code>Provider</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>FileCollection.getElements()</code> API è½¬æ¢ã€‚å¯¹è¿™äº›ç±»ä¸äº†è§£çš„æœ‹å‹å¯ä»¥å‚è€ƒ <a href="https://docs.gradle.org/current/userguide/working_with_files.html#working_with_files">Working with Files</a> å’Œ <a href="https://docs.gradle.org/current/userguide/lazy_configuration.html">Lazy Configurations</a>ã€‚</p>
<p><strong><a href="https://gradle-community.slack.com/archives/CA7UM03V3/p1624759837322700">Q2</a>: Gradle 7.1 + zulu arm64 JDK11 do not run natively on my M1 Mac mini.</strong></p>
<p>A2: è¿™åˆ™é—®é¢˜æˆ‘åæ¥è‡ªå·±å‘ç°äº†é—®é¢˜ï¼ˆå°é»„é¸­è°ƒè¯•æ³•ï¼‰ï¼Œå› ä¸ºæˆ‘ä½¿ç”¨ SDKMAN! å®‰è£…çš„ zulu çš„sdkï¼Œä½†æ˜¯ SDKMAN! æœ¬èº«æ˜¯é€šè¿‡ Rosetta2 è½¬è¯‘è¿è¡Œçš„ï¼ŒåŠ ä¸Šå®ƒåœ¨å‘½ä»¤è¡Œ <code>bash_profile</code> / <code>zshrc</code> æ·»åŠ äº†ä¸€äº›ä¸œè¥¿ï¼ˆæ²¡ç»†çœ‹äº†...å¤§æ¦‚æ˜¯ä¸ºäº†æ”¯æŒ Java ç‰ˆæœ¬çš„åˆ‡æ¢ç­‰ï¼‰ï¼Œå¯¼è‡´ Gradle èµ· java è¿›ç¨‹æ—¶ä¹Ÿéƒ½é€šè¿‡ Rosetta2 å»è·‘ã€‚åˆ æ‰é‡è£…åå³å¯ã€‚</p>
<p><img src="https://2bab-images.lastmayday.com/blog/20210712213206.png?imageslim" alt=""></p>
<p><strong><a href="https://gradle-community.slack.com/archives/CA83B1VLL/p1622211648007000">Q3</a>ï¼šFrom the performance perspective, is buildSrc still a bit worse than composite build?</strong></p>
<p>A3:</p>
<ul>
<li>
<p>@Vampire: This should still be true, but depending on your test project you might or might not be hit by a performance hit compared to composite builds. If your test project is too simple you will for example not see any difference. The point is, that <code>buildSrc</code> is automatically added to the class path of all build scripts in the main build and due to that the runtime class path of all tasks changed and thus all tasks in all projects are out of date if anything in <code>buildSrc</code> changes. If you use composite builds instead, only the dependencies you actually use by applying a plugin or adding it to the <code>buildscript</code> dependencies block are added to the class path of that specific build script, so all other build scripts / projects stay unaffected. If you apply all plugins you have to all projects you have, then there sill probabaly be no performance difference, as then still all tasks are going to be out of date when something is changed.I personally only use composite builds nowadays, also because I can then easily use composite build within (though there is a &quot;work-around&quot; now) and I can also move and rename it, for example to <code>&lt;root project&gt;/gradle/build-logic</code> instead of <code>&lt;root project&gt;/buildSrc</code>.</p>
</li>
<li>
<p>@CristianGM: And...I should add another small difference, buildSrc runs its tests when it compiles, while composite build doesn't</p>
</li>
</ul>
<p>è¿™åˆ™é—®é¢˜è®¨è®ºäº†åœ¨å“ªäº›æƒ…å†µä¸‹ composite-build ä¼˜äº buildSrcï¼Œä¸»è¦çš„æ€§èƒ½é—®é¢˜é›†ä¸­åœ¨æ˜¯å¦æŠŠè¿™ä¸ªé¢å¤–çš„ç¼–è¯‘è„šæœ¬æ¨¡å— apply åˆ°æ‰€æœ‰çš„ä¸»ä»£ç æ¨¡å—ä¸­ã€‚</p>
<p><strong><a href="https://t.me/AndroidDevCn/195956">Q4</a>: æˆ‘æ‰§è¡Œ gradlew bundle å‘½ä»¤çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆæ¯ä¸ª product flavor é‡Œé¢çš„é…ç½®éƒ½ä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Ÿå¦‚ä½•ç»™æ¸ é“è®¾ç½®ç‰ˆæœ¬åç§°ï¼Ÿ</strong></p>
<pre class="language-kotlin"><code class="language-kotlin">producatFlavors <span class="token punctuation">{</span> <br>    india <span class="token punctuation">{</span> <br>        <span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"archivesBaseName"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"urbanic-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">versioNameIndia</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">currentVersionCode</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span> <br>    <span class="token punctuation">}</span><br>    <br>    india <span class="token punctuation">{</span> <br>        <span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"archivesBaseName"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"urbanic-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">versioNameOther</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">currentVersionCode</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span> <br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>A4:</p>
<ul>
<li>Gradle é…ç½®é˜¶æ®µçš„è„šæœ¬æ˜¯å…¨éƒ¨éƒ½ä¼šæ‰§è¡Œçš„ï¼Œä¸ç„¶æ²¡æ³•å¾—åˆ°é…ç½®å¥½çš„ Extensionï¼Œä¹Ÿæ²¡åŠæ³•å¾—åˆ° Task Graphï¼›</li>
<li>å°±è¿™æ®µè„šæœ¬è€Œè¨€å®ƒæ˜¯æ‰§è¡Œ Flavor çš„é…ç½®ï¼Œåƒ <code>dimension</code> <code>applicationIdSuffix</code> <code>buildConfigField</code> éƒ½æ˜¯ä½œç”¨äº flavor çš„ï¼ˆéšè—çš„ this æ˜¯ ProdcutFlavor)ï¼Œ<code>setProperty</code> æ˜¯ä½œç”¨äº project çš„ï¼Œæ‰€ä»¥ä¼šè¢«è¦†ç›–ï¼›</li>
<li><code>archivesBaseName</code> çš„é…ç½®çœ‹äº†ä¸‹æ˜¯ä» Gradle API æ¥çš„ï¼Œå¹¶ä¸æ˜¯ AGP çš„ï¼ˆAGP æœ‰æŒºå¤šåœ°æ–¹ç”¨äº†ä¸è¿‡ï¼Œä½†æ˜¯æ²¡æ³•æ variant aware çš„ç­–ç•¥ï¼‰ï¼Œå¦‚æœä½ çœŸæƒ³ hack ä¸€ä¸‹ï¼Œé‚£å°±æ ¹æ®ä½ è¾“å…¥çš„å‘½ä»¤ hardcode å¯¹åº”çš„ propertyï¼š<code>if(gradle.startParameter.getTaskNames().get(0).contains(&quot;India&quot;)) { setProperty(...) }</code></li>
<li>ç°åœ¨åº”è¯¥ç”¨è¿™ä¸ªäº† Artifacts APIï¼š<a href="https://github.com/android/gradle-recipes/blob/agp-4.2/Kotlin/getApksTest/app/build.gradle.kts">https://github.com/android/gradle-recipes/blob/agp-4.2/Kotlin/getApksTest/app/build.gradle.kts</a> ï¼ˆå¯ä»¥åˆ‡åˆ†æ”¯æŸ¥çœ‹ä¸åŒç‰ˆæœ¬ AGP çš„ APIï¼Œ7.0 åç¨³å®šäº†ï¼‰ï¼Œæ·»åŠ ä¸€ä¸ª Task è·å–å¯¹åº”æ¸ é“ APK åå†ä¿®æ”¹åç§°ã€‚</li>
</ul>
<p><strong>Q5: å¯¹äºæƒ³åœ¨ assembleDebug åå¯¹ APK æ‰§è¡Œä¸€äº›æ“ä½œçš„æƒ…å†µï¼Œå¯ä»¥ç”¨ <code>finalizeBy()</code>ã€‚</strong></p>
<p>A5:</p>
<p>æˆ‘ä¹Ÿç»å¸¸å¿ä¸ä½ç”¨ğŸ˜‚ï¼Œä½†æ˜¯è¿™ä¸ª API æœ‰å‡ ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>å¦‚æœä¸€ä¸ª task æœ‰å¤šä¸ª finalizerï¼Œå®ƒä»¬æ˜¯æŒ‰ finalizer çš„åå­—æ’åºï¼ˆç›¸å½“äºä¹±åºï¼›</li>
<li>Finalizer å¯ä¸ç®¡å‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡ŒæˆåŠŸæ²¡(è§é™„å›¾)ï¼Œåªè¦å‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œäº†ï¼Œå®ƒå°±æ€»æ˜¯ä¼šæ¥ç€æ‰§è¡Œï¼›</li>
</ol>
<p>ä¸Šé¢ä¸¤ç‚¹å…¶å®æ˜¯ by design çš„ï¼Œæ‰€ä»¥å®˜æ–¹æ–‡æ¡£çš„ç”¨ä¾‹æ˜¯ç”¨æ¥åš task çš„èµ„æºæ¸…ç†å·¥ä½œã€‚æˆ‘ä¸€ç›´è§‰å¾—è‡ªå·±æœ‰ç‚¹æ»¥ç”¨ï¼Œä¸è¿‡æœ‰éœ€è¦æ²¡åŠæ³•çš„æ—¶å€™ä¹Ÿåªèƒ½ç”¨ã€‚</p>
<p>å°±è¿™ä¸ª case å¯èƒ½çš„å‡ ä¸ªåˆ«çš„è§£æ³•æ˜¯ï¼š</p>
<ol>
<li>ç”¨ <code>doLast()</code>ï¼Œä½†æ˜¯åªæ¥å— <code>Action</code> è€Œä¸æ˜¯ <code>Task</code>ï¼›</li>
<li>åå‘ <code>dependsOn()</code>, è®© <code>apkRenameDebug.dependsOn(resguardDebug)</code>ï¼Œç„¶åæ‰§è¡Œç»ˆç«¯æ‰§è¡Œ <code>apkRenameDebug</code>ï¼›</li>
<li>åŠ ä¸€ä¸ªç±»ä¼¼ lifecycle task çš„é”šç‚¹ task ä½œä¸ºæœ€åè¿è¡Œçš„ taskï¼Œç„¶åæŠŠå‰é¢é‚£äº› task å¾€ä»–ä¸Šé¢ <code>dependsOn()</code>ï¼Œç®—æ˜¯ 2 çš„ä¼˜åŒ–ç‰ˆï¼ˆæ¯”è¾ƒå¥½çœ‹å¹²å‡€ï¼‰ï¼›</li>
<li>ç”¨ <code>buildFinish()</code> ç”Ÿå‘½å‘¨æœŸç›‘å¬å™¨ï¼Œæ‰€æœ‰ä»»åŠ¡è·‘å®Œåå– apk åšå¤„ç†å¯ä»¥ä¸éœ€è¦ä¾èµ– AGPï¼›</li>
<li>ç”¨æ–°çš„ Artifacts API ï¼ˆè§ A4 çš„é“¾æ¥ï¼‰ã€‚</li>
</ol>
<p><img src="https://2bab-images.lastmayday.com/blog/lu2nXbi7yEZ1p0eoD3eKMSCjsKYy.jpeg?imageslim" alt=""></p>
<h2 id="kotlin-%E5%91%A8%E8%BE%B9%EF%BC%9Akoin%2Fktor%2Fcoil%2F..." tabindex="-1">Kotlin å‘¨è¾¹ï¼šKoin/Ktor/Coil/...</h2>
<p><strong><a href="https://kotlinlang.slack.com/archives/C0A974TJ9/p1623070601174400">Q1</a>: Is it possible a feature/plugin depends on another?I need to transform the type with my feature before JsonFeature get it. The problem is JsonFeature should be able to parse SomeError or User, so I have to unwrap it from my Either before, if not, JsonFeature will try it with the Either class and it will fail.</strong></p>
<p>A1: For ktor client's plugin I used/created, I don't think there's a direct approach to implement this. But if u look into their implementations, can see the interceptor pipelines - base on the lifecycle of those pipeline, u can define the running sequence and thus make dependent relationship indirectly. In this case, probably u can use HttpResponsePipeline.Receive in your custom plugin to unwrap before JsonFeature works.</p>
<pre class="language-kotlin"><code class="language-kotlin">scope<span class="token punctuation">.</span>responsePipeline<span class="token punctuation">.</span><span class="token function">intercept</span><span class="token punctuation">(</span>HttpResponsePipeline<span class="token punctuation">.</span>Receive<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>info<span class="token punctuation">,</span> body<span class="token punctuation">)</span> <span class="token operator">-></span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>body <span class="token operator">!</span><span class="token keyword">is</span> ByteReadChannel<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token label symbol">@intercept</span><span class="token punctuation">}</span><br>    <span class="token comment">// Do something you want and get the final result in String (others types I did not try)</span><br>    <span class="token keyword">val</span> result<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span><span class="token function">readRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token function">proceedWith</span><span class="token punctuation">(</span><span class="token function">HttpResponseContainer</span><span class="token punctuation">(</span>info<span class="token punctuation">,</span> <span class="token function">ByteReadChannel</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre>
<p><strong>Q2: Coil åŠ è½½æ—¶æŠ¥é”™ <code>Software rendering doesn't support hardware bitmaps</code></strong></p>
<p>A2ï¼š</p>
<ol>
<li><a href="https://coil-kt.github.io/coil/recipes/#shared-element-transitions">Recipes - Coil</a>ï¼Œä½ å¤§æ¦‚ç‡æ˜¯ç¢°åˆ°äº†ï¼šShared element transitions are incompatible with hardware bitmapsï¼›</li>
<li>é™¤äº†ä¸Šé¢é‚£ä¸ªï¼Œè¿˜æœ‰ä¸€äº›æœºå‹åŸç”Ÿä¸æ”¯æŒï¼Œä»¥åŠ OS ç‰ˆæœ¬åŸç”Ÿä¸æ”¯æŒçš„ï¼Œåº“æœ¬èº«åº”è¯¥æ˜¯å¤„ç†å¥½äº†ï¼š<a href="https://github.com/coil-kt/coil/blob/main/coil-base/src/main/java/coil/memory/HardwareBitmapService.kt">https://github.com/coil-kt/coil/blob/main/coil-base/src/main/java/coil/memory/HardwareBitmapService.kt</a></li>
<li>æŸ¥çœ‹æ‰€æœ‰ç›¸å…³ issueï¼Œæ¯”å¦‚<a href="https://wx.zsxq.com/dweb2/index/group/51285415155554">è¿™ä¸ª</a>ï¼Œæ²¡æœ‰çœ‹åˆ°è¶…å‡ºä¸Šè¿°èŒƒå›´çš„è®¨è®ºï¼Œæ‰€ä»¥æˆ‘è§‰å¾—åº”è¯¥å°±æ˜¯è¿™æ ·å•¦ã€‚</li>
</ol>
<p><em>æ¬¢è¿å…³æ³¨æˆ‘çš„<a href="/about"> Github / å…¬ä¼—å· / æ’­å®¢ / å¾®åš / Twitter</a>ã€‚</em></p>

    </div>
    <hr />
      <div class="text-sm text-center">
        è¯„è®ºå’Œäº¤æµè¯·å‘é€é‚®ä»¶åˆ° xx2bab@gmail.com
      </div>
      <hr />
     <div class="text-center">
  <img class="w-64 inline-block" src="https://s2.loli.net/2023/05/13/FKYi5STEtmNZd8W.jpg" alt="Wechat Donate QACode" />
  <div class="text-sm">
    é€šè¿‡å¾®ä¿¡æ‰«æèµèµç èµåŠ©æ­¤æ–‡
  </div>
</div> 
    <footer class="text-sm py-12 text-gray-500 text-center">
  
  <p><a href="/en">ENG</a> / <a href="/zh">ä¸­æ–‡</a></p>
  
  2BAB's Blog since 2014
</footer>
  </div>

</div>



</body>
</html>